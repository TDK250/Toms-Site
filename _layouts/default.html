<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'en' }}">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{% if page.title %}{{ page.title | escape }} - {{ site.title | escape }}{% else %}{{ site.title | escape }}{% endif %}</title>
  <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">

  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
  <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="{{ '/assets/images/favicon.png' | relative_url }}">
  
  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="{{ site.title | escape }}" href="{{ '/feed.xml' | relative_url }}">

  <!-- Feather Icons CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js"></script>

  <!-- Basic SEO tags -->
  <meta name="author" content="{{ site.author.name | default: site.title }}">
  <meta property="og:title" content="{% if page.title %}{{ page.title | escape }} - {{ site.title | escape }}{% else %}{{ site.title | escape }}{% endif %}">
  <meta property="og:description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
  <meta property="og:type" content="website">

  <!-- Enhanced Theme Script -->
  <script>
    (function() {
      // Function to apply theme
      function applyTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        if (theme !== 'auto') {
          localStorage.setItem('theme', theme);
        }
      }
      
      // Function to get system preference
      function getSystemTheme() {
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }
      
      // Get saved theme preference or default to 'auto'
      const savedTheme = localStorage.getItem('theme');
      
      if (savedTheme && savedTheme !== 'auto') {
        applyTheme(savedTheme);
      } else {
        // Use system preference
        applyTheme(getSystemTheme());
        
        // Listen for system preference changes
        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        const handleChange = (e) => {
          // Only auto-switch if user hasn't manually set a preference
          const currentSaved = localStorage.getItem('theme');
          if (!currentSaved || currentSaved === 'auto') {
            applyTheme(e.matches ? 'dark' : 'light');
          }
        };
        
        // Modern browsers
        if (mediaQuery.addEventListener) {
          mediaQuery.addEventListener('change', handleChange);
        } else {
          // Fallback for older browsers
          mediaQuery.addListener(handleChange);
        }
      }
    })();
  </script>

  <style>
    /* Icon styling */
    .icon {
      width: 18px;
      height: 18px;
      stroke: currentColor;
      stroke-width: 2;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    
    .theme-toggle {
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: inherit;
    }
    
    .theme-toggle:hover {
      opacity: 0.7;
    }
    
    .social-links a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      color: inherit;
      padding: 4px;
    }
    
    .social-links a:hover {
      opacity: 0.7;
    }
  </style>
</head>

<body>
  <div class="site-wrapper">
    
    <!-- Header -->
    <header class="site-header">
      <div class="container">
        <nav class="site-nav">
          <a class="site-title" href="{{ '/' | relative_url }}">{{ site.title }}</a>
          
          <div class="nav-links">
            <a href="{{ '/blog' | relative_url }}" class="nav-link">Blog</a>
            <a href="{{ '/professional' | relative_url }}" class="nav-link">Professional</a>
            <a href="{{ '/contact' | relative_url }}" class="nav-link">Contact</a>
          </div>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <main class="site-main">
      <div class="container">
        {{ content }}
      </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
      <div class="container">
        <div class="footer-content">
          <p>&copy; {{ 'now' | date: "%Y" }} {{ site.author.name }}. Built with Jekyll & hosted on GitHub Pages.</p>
          <div class="social-links">
            {% if site.social.email %}
              <a href="mailto:{{ site.social.email }}" aria-label="Email">
                <i data-feather="mail" class="icon"></i>
              </a>
            {% endif %}
            {% if site.social.github %}
              <a href="https://github.com/{{ site.social.github }}" aria-label="GitHub">
                <i data-feather="github" class="icon"></i>
              </a>
            {% endif %}
            {% if site.social.linkedin %}
              <a href="https://linkedin.com/in/{{ site.social.linkedin }}" aria-label="LinkedIn">
                <i data-feather="linkedin" class="icon"></i>
              </a>
            {% endif %}
            {% if site.social.twitter %}
              <a href="https://twitter.com/{{ site.social.twitter }}" aria-label="Twitter">
                <i data-feather="twitter" class="icon"></i>
              </a>
            {% endif %}
            <a href="{{ '/feed.xml' | relative_url }}" aria-label="RSS Feed">
              <i data-feather="rss" class="icon"></i>
            </a>
            
            <!-- Enhanced Theme Toggle -->
            <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
              <i data-feather="sun" class="icon theme-icon-light"></i>
              <i data-feather="moon" class="icon theme-icon-dark" style="display: none;"></i>
            </button>
          </div>
        </div>
      </div>
    </footer>

  </div>

  <!-- Enhanced Theme Toggle Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const themeToggle = document.getElementById('theme-toggle');
      const html = document.documentElement;
      const lightIcon = themeToggle.querySelector('.theme-icon-light');
      const darkIcon = themeToggle.querySelector('.theme-icon-dark');

      // Function to update theme toggle icon
      function updateThemeIcon() {
        const currentTheme = html.getAttribute('data-theme');
        if (currentTheme === 'dark') {
          lightIcon.style.display = 'none';
          darkIcon.style.display = 'block';
        } else {
          lightIcon.style.display = 'block';
          darkIcon.style.display = 'none';
        }
      }

      // Function to get system preference
      function getSystemTheme() {
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }

      // Update icon on page load
      updateThemeIcon();

      // Theme toggle click handler
      themeToggle.addEventListener('click', function() {
        const currentTheme = html.getAttribute('data-theme');
        const savedTheme = localStorage.getItem('theme');
        
        let newTheme;
        
        // Cycle through: auto -> light -> dark -> auto
        if (!savedTheme || savedTheme === 'auto') {
          // Currently on auto (system), switch to opposite of current system
          newTheme = getSystemTheme() === 'dark' ? 'light' : 'dark';
        } else if (savedTheme === 'light') {
          newTheme = 'dark';
        } else {
          // savedTheme === 'dark', go back to auto
          newTheme = 'auto';
          localStorage.removeItem('theme');
          newTheme = getSystemTheme(); // Apply current system theme
        }
        
        if (newTheme !== 'auto') {
          localStorage.setItem('theme', newTheme);
        }
        
        html.setAttribute('data-theme', newTheme);
        updateThemeIcon();
      });

      // Listen for system preference changes when in auto mode
      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
      const handleSystemChange = (e) => {
        const savedTheme = localStorage.getItem('theme');
        if (!savedTheme || savedTheme === 'auto') {
          html.setAttribute('data-theme', e.matches ? 'dark' : 'light');
          updateThemeIcon();
        }
      };

      if (mediaQuery.addEventListener) {
        mediaQuery.addEventListener('change', handleSystemChange);
      } else {
        mediaQuery.addListener(handleSystemChange);
      }

      // Initialize Feather icons
      feather.replace();
    });
  </script>
</body>

</html>
